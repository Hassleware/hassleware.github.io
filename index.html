<!DOCTYPE html>
<html>
<head>
    <title>Ryan's Art Portfolio</title>
    <meta charset="utf-8">
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <style>
        /* --- LIGHT THEME STYLING --- */
        body {
            font-family: sans-serif;
            /* CHANGED: Replaced fixed margin with responsive padding */
            margin: 0;
            padding: 20px; 
            background-color: white;
            color: black;
            text-align: center;
        }

        h2 { 
            margin-top: 40px; 
            text-transform: uppercase;
            font-size: 1.5rem; /* slightly responsive font size */
        }

        /* --- FLEX GALLERY --- */
        .gallery-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            min-height: 100px;
        }

        canvas {
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            background-color: #f0f0f0;
            cursor: pointer;
            transition: opacity 0.2s ease-in-out;
            
            /* NEW: This makes the canvases responsive! */
            max-width: 100%; 
            height: auto !important; /* Maintains aspect ratio */
        }

        canvas:hover { 
            opacity: 0.5;
        }

        /* --- MODAL STYLES --- */
        #modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; top: 0;
            width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.85); 
            align-items: center;
            justify-content: center;
            /* NEW: Backrdrop blur looks nice on iOS */
            backdrop-filter: blur(5px);
        }

        #modal-card {
            display: flex;
            flex-direction: row; 
            position: relative; /* Needed for close button positioning */
            max-width: 90%;
            max-height: 90%;
            background: transparent;
            box-shadow: 0 0 25px rgba(0,0,0,0.8);
        }

        #modal-img {
            display: block;
            max-height: 80vh; 
            max-width: 65vw;  
            height: auto; width: auto;
            image-rendering: pixelated; 
            background-color: black;
            /* NEW: Prevent image from getting too small on mobile */
            min-width: 200px; 
        }

        #modal-desc {
            width: 300px; 
            min-width: 200px;
            background-color: white; 
            color: black;            
            padding: 20px;
            overflow-y: auto;        
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            max-height: 80vh; 
            text-align: left;
            /* NEW: Smooth scrolling for iOS */
            -webkit-overflow-scrolling: touch;
        }

        /* NEW: Close Button Styling */
        .close-btn {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            padding: 5px 10px;
        }

        /* --- MOBILE & TABLET TWEAKS --- */
        @media (max-width: 800px) {
            body { padding: 10px; } /* Less padding on small screens */
            
            #modal-card { 
                flex-direction: column; 
                align-items: center; 
                background: white; /* Unified background for card feel */
            }
            
            #modal-img { 
                max-width: 100%; 
                max-height: 50vh; /* Leave room for text */
                width: 100%; /* Stretch to fill card width */
                object-fit: contain;
            }
            
            #modal-desc { 
                width: 100%; /* Fill the card width */
                max-height: 30vh; 
                box-sizing: border-box; /* Ensures padding doesn't break width */
            }

            .close-btn {
                top: 0;
                right: 0;
                color: black; /* Black X because background is white on mobile */
                background: rgba(255,255,255,0.7);
                border-radius: 0 0 0 5px;
            }
        }
    </style>
</head>
<body>

    <h1>Ryan's Portfolio</h1>

    <h2 id="digital-title">Loading Digital...</h2>
    <div id="digital-gallery" class="gallery-section"></div>

    <h2 id="real-title">Loading Real...</h2>
    <div id="real-gallery" class="gallery-section"></div>

    <div id="modal">
        <div id="modal-card">
            <span class="close-btn">&times;</span>
            <img id="modal-img" src="">
            <div id="modal-desc">
                <div id="sidebar-content">Loading info...</div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL ELEMENTS ---
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modal-img');
        const sidebarContent = document.getElementById('sidebar-content');
        const closeBtn = document.querySelector('.close-btn'); // NEW

        // --- CLOSE MODAL FUNCTIONS ---
        function closeModal() {
            modal.style.display = "none";
            modalImg.src = ""; 
        }

        // Click outside to close
        modal.addEventListener('click', function(e) {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

        // Click X button to close (NEW)
        closeBtn.addEventListener('click', closeModal);

        // --- REUSABLE LOADER FUNCTION (Recursive) ---
        function loadCollection(prefix, ext, galleryId, titleId, index = 1) {
            
            const gallery = document.getElementById(galleryId);
            const title = document.getElementById(titleId);
            
            const imgFile = prefix + index + ext;
            const htmlFile = prefix + index + ".html";

            const img = new Image();
            img.src = imgFile; 

            // SUCCESS
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Using 0.5 scale
                const newWidth = Math.floor(img.naturalWidth * 0.5);
                const newHeight = Math.floor(img.naturalHeight * 0.5);
                canvas.width = newWidth;
                canvas.height = newHeight;
                ctx.imageSmoothingEnabled = false; 
                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                gallery.appendChild(canvas);

                // Add Click Event
                canvas.addEventListener('click', function() {
                    modal.style.display = "flex"; 
                    modalImg.src = imgFile;
                    sidebarContent.innerHTML = "<em>Checking for description...</em>";

                    fetch(htmlFile)
                    .then(response => {
                        if (!response.ok) throw new Error("No description");
                        return response.text();
                    })
                    .then(htmlText => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(htmlText, 'text/html');
                        const descDiv = doc.getElementById('description') || doc.querySelector('[tag="description"]');
                        
                        if (descDiv) {
                            sidebarContent.innerHTML = descDiv.innerHTML;
                        } else {
                            sidebarContent.innerHTML = "<em>Found file, but missing &lt;div id='description'&gt;</em>";
                        }
                    })
                    .catch(err => {
                        sidebarContent.innerHTML = "<p>No description text found.</p>";
                    });
                });

                loadCollection(prefix, ext, galleryId, titleId, index + 1);
            };

            // ERROR / FINISHED
            img.onerror = function() {
                const finalCount = index - 1;
                if (galleryId === 'digital-gallery') {
                    title.innerText = finalCount + " Digital Drawings";
                } else {
                    title.innerText = finalCount + " Real Drawings";
                }
            };
        }

        // --- START LOADERS ---
        loadCollection("", ".gif", "digital-gallery", "digital-title");
        loadCollection("r-", ".gif", "real-gallery", "real-title");

    </script>
</body>
</html>